receivers:
  prometheus:
    config:
      scrape_configs:
        - job_name: 'spring-boot-app'
          # 1. 메트릭 수집 경로를 여기에 명시합니다.
          metrics_path: /actuator/prometheus
          static_configs:
            # 2. targets에는 순수한 '호스트:포트' 주소만 적습니다.
            # Collector와 Spring Boot 앱이 같은 작업(Task/Pod)에 있다면 localhost를 사용합니다.
            - targets: ['localhost:8080']

exporters:
  prometheusremotewrite:
    # 3. AWS_PROMETHEUS_ENDPOINT 환경 변수가 이 값을 채우도록 설정할 수 있습니다.
    #    직접 엔드포인트 주소를 적어도 됩니다.
    endpoint: "${AWS_PROMETHEUS_ENDPOINT}"
    auth:
      authenticator: sigv4auth

extensions:
  sigv4auth:
    service: "aps"
    # AWS 리전을 명시하거나 환경 변수로 설정할 수 있습니다.
    region: "${AWS_REGION}"

service:
  extensions: [sigv4auth]
  pipelines:
    metrics:
      receivers: [prometheus]
      exporters: [prometheusremotewrite]